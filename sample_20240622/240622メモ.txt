


==========================================================================
==========================================================================
==========================================================================


全8回



=====================================
24/06/22 第4回目
=====================================

---【前半：座学】---

ローカル座標・ワールド座標

ワールド空間は最小的には2次元のスクリーンに表示される。

3次元のワールド空間にオブジェクトが存在している。
マウスカーソルは2次元に存在している。
なので、衝突判定がややこしい。
座標の変換が必要。

メートル表記と緯度経度表記の地図を比較するには？
どちらかの表記に揃えないといけない。


「まず２次元、３次元の各座標概念をクリアにする必要がありますね。。？」
　┗　そうだけど、そんなに難しく考えなくて良い。
　　　2次元と3次元の空間は全然違うと認識するだけでOK。





---【後半：実習】---

---【024】---

「オブジェクトがすごく奥にあって見えない状態でもレイキャスターで交差判定されますか？」
┗　ニアクリップ、ファークリップの外側にあるものは反応しない。
内側にあれば、遠くにあっても反応する。

レイキャスターはCPUで処理している。
メッシュが細ければ細かいほど、頂点が多ければ多いほど、CPU負荷が高くなる…！カクつく。


「うまく言葉にできなくてすみませんが、例えば、Raycasterを使ってクリックしたオブジェクトが「A」(aria-labelの的な名前？)という名前のオブジェクトだった場合、それを取得することは可能でしょうか？」
┗　メッシュに名前やuuidを設定できる。userDataでも。

「ちなみに一般的にメッシュに名前ってつけるのでしょうか？」
┗　必要がなければつけなくて良い。だいたい自分で名前をつけた変数に入れているので…。
あんまりしないかな…。名前つけたいときがないかも。

「逆に使う事例ってありますか？」
┗　あんまりない…。nameプロパティが無いと出来ないこと、というのがない。
好みの問題かも。




---【025】---

Float32Array　：数字しか入らない。32bitのフロートしか入らない。

「このposition属性は、meshの位置を設定するためのposition.yとは全くの別物の話ですよね？」
┗　全然別ですね！今やっているのはローカル空間のジオメトリを作っている作業。



---【026】---

ポイントスプライト

「コメントでビルボードと書いてあるのですが、ここでいうビルボードはどういう意味ですか？」
┗　描画負荷が高くなってしまうときに、ビルボードを使う。
木とか、頂点が多いオブジェクトがたくさんある場合、ビルボードを使用して負荷を抑える。
古くからあるテクニック。。。


「追加で質問なんですが、 points.lookAt(camera)みたいにしたら、また違う挙動ですか？」
┗　ぜんぜん違う。。ジオメトリ全体としては姿勢は変わるけど、点の向きは変わらない。
そもそも点に傾きや厚みは無い。


「星が重なると、奥にある星に影のようなものが重なって見えるのですが、pointのポリゴンが正方形でそれが透過されていないため、ということでしょうか？」
┗　その通りです。


「少し話題が戻ってしまいますが、 sizeAttenuationをtrueにしたときの見え方が、平行投影のカメラで見たときと同じように見えました。これは全く違う概念ですよね？」
┗　falseじゃないかな？そうですね、違う概念です。
空間自体はパースの掛かったカメラで表示されている




---【027】---

メッシュごと（Object3Dごと）にZソートしてくれるが、
今回はジオメトリ内で頂点がたくさんあるので、メッシュごとのZソートが適応されない。

大量の頂点を1つのジオメトリでシーンにaddする　→　早いがZソートされない
1つの頂点を大量のメッシュでシーンにaddする　→　めっちゃ重くなる。GPUで描画が早くなるというメリットを捨てることになる。

どちらを選ぶか。。。

CG的には一回で出来るだけまとめてドカッと書いたほうが良い。早い。

blending mode を AdditiveBlending に切り替える。
加算合成
AdditiveBlending はどんどん色を足していくので、見た目の違いがわからなくなってくる（いい意味で）。

この辺は感覚や経験かも…。
これが絶対の正解ではない…！



「ちょっと戻るんですが、（さっきの木のような）長方形のビルボードを作りたい場合、 大きめのポイントに左右が透明になっている木の画像を貼る、でいいんでしょうか？」
┗　普通のビルボードをやりたい場合、木とかなら、点では表現しきれない。
大きめのポイントではなく、ポリゴンでやらないとダメですね。
プレーンジオメトリとかでやる。
テクスチャを貼ったポリゴンにする。

（ブログ記事）
Y軸だけビルボードにすると、まぁちゃんと見えるけど、ちゃんと計算しないといけない。

ポイントスプライトをビルボードで使う場面は限られる。
例えば銀河とか…。
木とかは難しい。。。CG的な難しさ。




---【028】---

Sketchfab - The best 3D viewer on the web
3D Models for Professionals :: TurboSquid
Free3D.com






---【029】---

暗記しなくてOK
ミキサー
アクション


「サイトなどからモデルをダウンロードする前に、事前にアニメーション情報って確認できますか？」
┗　サイトのインターフェースによりけり…。
Sketchfabとかはわかるかも。


Babylon.js Sandbox - View glTF, glb, obj and babylon files
ここに入れるとglTFが確認できる。
出来ないことがほぼ無い。テクスチャなども変更できる…！



「この狐のデータの場合「一定時間首を振ってから首振りを停止、つぎに歩き出す」ようなアニメーションをしたい場合はrequestAnimationFrame内で各ウェイトを制御するイメージですか？ウェイトもいきなり1.0->0.0にすると不自然なアニメになりそうですから、うまいこと制御するのだろうなと思います。」
┗　仰るとおり。。3秒間は首振りウェイトを1にして、次の1秒間で0.5にして……など。
ヨコの動き（走って移動）を最初からモデルに入れておく…というのもアリ。
ケースバイケース。


「紹介されていたサイトなどの無料の3Dモデルを使用する際に、ライセンスなどで注意するポイントはありますか？（Webの場合、アップしたら誰でもモデルにアクセスできると思うので、再頒布的な扱いになるのかなと）」
┗　怪しかったら本人に聞いてみるしか無い…。「この使い方は大丈夫？」
有料のものは大抵大丈夫…。


「経過時間をつかってアニメーションを実装する場合、別タブに移動してる間も経過時間って進んでいるのでしょうか？ もし進んでいるとしたら、別タブに移動中は経過時間を止めて戻ってきた時に再度経過時間を取得するてことでしょうか？」
┗　別タブに行ってても、時間は進む。



「ブラウザって最大どの程度のファイルサイズの3Dファイルに耐えられるんでしょうか？」
┗　なんとも言えない…。
ブラウザというよりも、実行環境のメモリ次第。
3Dは一気に展開しないといけないので、（ストリーミング可能な）動画とかよりは上限は低い…。
実用的なサイズは100MB以下かな…。
500MB・1GBとかになると、メモリがかなり大きくないと難しい。

普段は「10MBは重いよ…！出来れば数MBに抑えてほしい」と言っている。
数が増えていって、最終的に100MBになってしまう。。



「THREE.ClockのgetElapsedTimeメソッドも前回サンプルでありましたが、getDeltaメソッドとはどういう違いがあるのでしょうか？」
┗　getElapsedTimeは呼び出してからの経過時間
getDeltaは前回呼び出したときからの差分の時間




google/draco
圧縮ツール

テクスチャに使う画像が大きすぎる場合は、あまり効果ない。。

デコーダの容量と、それを実行するリソースもかかることを理解する。

three.jsはdraco圧縮に対応してる。
追加プラグインをインポートする…？



「glTFを圧縮すれば、画質（?）は落ちるものなのでしょうか？」
┗　あくまでglTFはモデルデータなので、デコーダで元に戻すので、品質は落ちない。





---【030】---

レンダラーのような、世界を描画するものに、影を使うと申請する。
・影を落とすもの
・影を受けるもの
の設定をする。

カメラヘルパー
ここでのヘルパーは、ライトに紐づいているカメラのヘルパー。


「directionalLight以外の他のライトでも、影は落とせるのでしょうか？動くpointLightで影を落とす、となると処理は重くなるとの認識であっていますか？」
┗　pointLightでも影は落とせる。特定の位置があるライトは影を落とせる。
アンビエントライトのような、位置がないようなライトでは無理。
動くライトについて、光源も一緒に動いているので、
動くからといって負荷が増えることはない。
ただ、数が増えると処理が大幅に増える…。





---【031】---

ノートとかに、処理手順を整理して書いていくと良い。

アヒルだけのシーン、白背景のシーンと、2回描画している。

「オフスクリーンレンダリングすると負荷は高くなりますか？」
┗　2回描画しているので、負荷は高くなる。


処理フローが複雑になるのが難しい。。


「ちなみにresizeメソッドには、オフスクリーン用の処理は必要ないですか？」
┗　アヒルの方はまた別世界なので、ここでは関係ない。
ウインドウのサイズに応じてオフスクリーンされるなら、リサイズ処理が必要。


「枠内の画像をパララックスさせる処理をthree.jsで見かけるのですが、それはオフスクリーンを使用しているのでしょうか。」
┗　オフスクリーンなくても出来そう。
テクスチャの一部分だけを貼り付けて、カーソルに応じてオブジェクトをちょっと動かす…とか。
視差効果…。
一番シンプルな方法はシェーダを使うか…。


「話が戻ります。影の色はどのように決まっているのでしょうか？影の色を変えたり、柄を追加することはThree.jsでは可能でしょうか？」
┗　わからない…！柄の追加は無理だと思う。
いろいろ工夫がいるかも。

┗　https://threejs.org/examples/?q=light#webgl_lights_spotlights
┗　あとこれ見つけました。https://stackoverflow.com/questions/49348288/change-the-shadow-color-to-any-other-color-in-three
┗　ShadowMaterial（https://threejs.org/docs/#api/en/materials/ShadowMaterial）は違いますかね？

┗　影を受ける板のマテリアルにShadowMaterialを設定してみたら、影のところだけ描画？されて、影のないところは透明になりました。ただ、色の設定はできたので、普通のマテリアルの板と2枚おけば影の色だけ変えられそうでした。



---【まとめ】---




課題：
さて最後に今回の課題ですが、Raycaster と Plane(板)を使ってなに か作ってみましょう。
たとえば「サムネイルをリンクのように扱う」であったり「画像のビュ ーアを 3D で作る」といったなにかしらのテーマを決めると作りやすい かもしれません。以下、アイデアの参考に。

CLOU architects
https://www.clouarchitects.com/


------------------
【講義後の質問】
------------------


